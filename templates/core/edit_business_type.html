{% extends 'base.html' %}

{% block title %}Edit Business Type - AI Agent Customer Service{% endblock %}

{% block content %}
<!-- Dashboard-style Hero Section -->
<div class="bg-gradient-dark text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-gradient-primary rounded-circle p-3 me-3" style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-store text-white fs-4"></i>
                    </div>
                    <div>
                        <h1 class="mb-1 fs-2 fw-bold">Business Type Settings</h1>
                        <p class="mb-0 opacity-75">Customize your AI assistant for your specific business</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{% url 'dashboard' %}" class="btn btn-sm btn-outline-light">
                    <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                </a>
            </div>
        </div>
        
        <!-- Business Type Stats Alert -->
        <div class="alert alert-info glass-effect mt-4">
            <div class="row g-2">
                <div class="col-lg-3 col-md-6">
                    <strong>Current Type:</strong> {{ assistant.business_type.name }}
                </div>
                <div class="col-lg-3 col-md-6">
                    <strong>Q&As:</strong> {{ assistant.qnas.count }} items
                </div>
                <div class="col-lg-3 col-md-6">
                    <strong>Knowledge Base:</strong> {{ assistant.knowledge_base.count }} items
                </div>
                <div class="col-lg-3 col-md-6">
                    <strong>Status:</strong> <span class="badge bg-success">Active</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-n3 position-relative" style="z-index: 10;">
    <div class="row justify-content-center">
        <div class="col-12 col-xl-10">
            <!-- Info Card -->
            <div class="card-modern mb-4">
                <div class="card-body-modern">
                    <div class="d-flex align-items-center mb-3">
                        <div class="bg-gradient-primary rounded-circle p-2 me-3" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-info-circle text-white"></i>
                        </div>
                        <div>
                            <h6 class="mb-1 fw-semibold">Business Type Configuration</h6>
                            <p class="mb-0 text-muted small">Updating your business type will change how your AI assistant responds to customers and can optionally regenerate Q&As to match your new business context</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Current Business Type Card -->
            <div class="card-modern mb-4">
                <div class="card-header-modern d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-building me-2 text-primary-modern"></i>
                        <h5 class="mb-0 fw-semibold">Current Business Configuration</h5>
                    </div>
                    <span class="badge bg-primary">Active</span>
                </div>
                <div class="card-body-modern">
                    <div class="d-flex align-items-center p-3 bg-light rounded-3">
                        <div class="bg-gradient-primary rounded-circle p-3 me-3" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-store text-white"></i>
                        </div>
                        <div>
                            <h6 class="mb-1 fw-semibold">{{ assistant.business_type.name }}</h6>
                            {% if assistant.business_type.description %}
                                <p class="mb-0 text-muted small">{{ assistant.business_type.description }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Change Business Type Form -->
            <div class="card-modern">
                <div class="card-header-modern">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-exchange-alt me-2 text-warning"></i>
                        <h5 class="mb-0 fw-semibold">Update Business Type</h5>
                    </div>
                </div>
                <div class="card-body-modern">
                    <form method="post" id="businessTypeForm">
                        {% csrf_token %}
                        
                        <div class="mb-4">
                            <label for="{{ form.business_type.id_for_label }}" class="form-label fw-semibold text-primary-modern">
                                <i class="fas fa-arrow-right me-1"></i>Select New Business Type
                            </label>
                            {{ form.business_type }}
                            {% if form.business_type.errors %}
                                <div class="text-danger small mt-1">
                                    {{ form.business_type.errors.0 }}
                                </div>
                            {% endif %}
                            <div class="form-text mt-2">
                                <i class="fas fa-lightbulb me-1 text-warning"></i>
                                Choose the business type that best describes your operations for optimal AI assistant configuration.
                            </div>
                        </div>
                        
                        <!-- Q&A Regeneration Options -->
                        <div class="card-modern mb-4" style="border: 2px solid var(--warning); background: rgba(255, 193, 7, 0.05);">
                            <div class="card-header-modern bg-warning bg-opacity-10">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-question-circle me-2 text-warning"></i>
                                    <h6 class="mb-0 fw-semibold">Q&A Management Options</h6>
                                </div>
                            </div>
                            <div class="card-body-modern">
                                <div class="form-check p-3 bg-white rounded-3 border">
                                    <input class="form-check-input" type="checkbox" id="regenerate_qnas" name="regenerate_qnas">
                                    <label class="form-check-label fw-semibold" for="regenerate_qnas">
                                        <i class="fas fa-sync-alt me-1 text-primary"></i>
                                        Regenerate Q&As for new business type
                                    </label>
                                    <div class="form-text mt-2">
                                        <div class="alert alert-warning border-0 mb-0">
                                            <div class="d-flex align-items-start">
                                                <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                                                <div>
                                                    <strong>Important:</strong> If checked, all your current Q&As ({{ assistant.qnas.count }} items) will be <strong>permanently replaced</strong> 
                                                    with new auto-generated Q&As for the selected business type. If unchecked, your existing Q&As will be preserved.
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Current Q&As Preview -->
                                {% if assistant.qnas.count > 0 %}
                                <div class="mt-4">
                                    <h6 class="fw-semibold text-muted mb-3">
                                        <i class="fas fa-eye me-1"></i>Current Q&As Preview ({{ assistant.qnas.count }} total)
                                    </h6>
                                    <div class="qna-preview-list">
                                        {% for qna in assistant.qnas.all|slice:":3" %}
                                            <div class="qna-preview-item p-3 mb-2 border rounded-3 bg-white">
                                                <div class="d-flex align-items-start">
                                                    <div class="bg-gradient-primary rounded-circle p-2 me-3 flex-shrink-0" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                                        <i class="fas fa-question text-white small"></i>
                                                    </div>
                                                    <div class="flex-grow-1">
                                                        <div class="mb-2">
                                                            <strong class="text-primary">Q:</strong> 
                                                            <span class="text-dark">{{ qna.question|truncatechars:60 }}</span>
                                                        </div>
                                                        <div>
                                                            <strong class="text-success">A:</strong> 
                                                            <span class="text-muted">{{ qna.answer|truncatechars:80 }}</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                        {% if assistant.qnas.count > 3 %}
                                            <div class="text-center">
                                                <span class="badge bg-secondary">... and {{ assistant.qnas.count|add:"-3" }} more Q&As</span>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% else %}
                                <div class="mt-4 text-center p-4 bg-light rounded-3">
                                    <div class="bg-gradient-primary rounded-circle mx-auto mb-3" style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-question-circle text-white"></i>
                                    </div>
                                    <h6 class="text-muted mb-2">No Q&As Currently Configured</h6>
                                    <p class="text-muted small mb-0">Selecting a new business type with regeneration enabled will create Q&As automatically.</p>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Knowledge Base Information -->
                        <div class="alert alert-info border-0 glass-effect mb-4">
                            <div class="d-flex align-items-start">
                                <div class="bg-gradient-primary rounded-circle p-2 me-3 flex-shrink-0" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-database text-white"></i>
                                </div>
                                <div>
                                    <h6 class="mb-2 fw-semibold">Knowledge Base Protection</h6>
                                    <p class="mb-2">Your knowledge base content ({{ assistant.knowledge_base.count }} items) will remain completely unchanged during this business type update.</p>
                                    <div class="d-flex align-items-center">
                                        <span class="me-3">Manage separately:</span>
                                        <a href="{% url 'edit_knowledge_base' %}" class="btn btn-sm btn-primary">
                                            <i class="fas fa-external-link-alt me-1"></i>Knowledge Base Editor
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                            <a href="{% url 'dashboard' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i>Cancel Changes
                            </a>
                            <button type="submit" class="btn btn-primary-modern" onclick="return confirmChange()">
                                <i class="fas fa-save me-2"></i>Update Business Type
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Impact Information Cards -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card-modern h-100">
                        <div class="card-header-modern bg-success bg-opacity-10">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-check-circle me-2 text-success"></i>
                                <h6 class="mb-0 fw-semibold text-success">Will Be Updated</h6>
                            </div>
                        </div>
                        <div class="card-body-modern">
                            <div class="update-list">
                                <div class="update-item d-flex align-items-center mb-3">
                                    <div class="bg-success rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-robot text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">AI Assistant Configuration</div>
                                        <small class="text-muted">Name and behavior in OpenAI</small>
                                    </div>
                                </div>
                                <div class="update-item d-flex align-items-center mb-3">
                                    <div class="bg-success rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-cogs text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">System Instructions</div>
                                        <small class="text-muted">AI behavior and context</small>
                                    </div>
                                </div>
                                <div class="update-item d-flex align-items-center mb-3">
                                    <div class="bg-success rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-building text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">Business Context</div>
                                        <small class="text-muted">Response style and tone</small>
                                    </div>
                                </div>
                                <div class="update-item d-flex align-items-center">
                                    <div class="bg-warning rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-question-circle text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">Q&As <span class="badge bg-warning">Optional</span></div>
                                        <small class="text-muted">If regeneration is selected</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card-modern h-100">
                        <div class="card-header-modern bg-info bg-opacity-10">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-shield-alt me-2 text-info"></i>
                                <h6 class="mb-0 fw-semibold text-info">Will Stay Protected</h6>
                            </div>
                        </div>
                        <div class="card-body-modern">
                            <div class="protected-list">
                                <div class="protected-item d-flex align-items-center mb-3">
                                    <div class="bg-info rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-key text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">API Configuration</div>
                                        <small class="text-muted">Your OpenAI API key</small>
                                    </div>
                                </div>
                                <div class="protected-item d-flex align-items-center mb-3">
                                    <div class="bg-info rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-database text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">Knowledge Base</div>
                                        <small class="text-muted">All uploaded documents</small>
                                    </div>
                                </div>
                                <div class="protected-item d-flex align-items-center mb-3">
                                    <div class="bg-info rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-history text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">Chat History</div>
                                        <small class="text-muted">Previous conversations</small>
                                    </div>
                                </div>
                                <div class="protected-item d-flex align-items-center">
                                    <div class="bg-info rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-sliders-h text-white small"></i>
                                    </div>
                                    <div>
                                        <div class="fw-semibold">Other Settings</div>
                                        <small class="text-muted">Personal preferences</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modern Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content border-0 shadow-lg">
            <div class="modal-header bg-gradient-dark text-white border-0">
                <h5 class="modal-title fw-semibold">
                    <i class="fas fa-exclamation-triangle me-2"></i>Confirm Business Type Change
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div id="confirmMessage"></div>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Cancel
                </button>
                <button type="button" class="btn btn-primary-modern" onclick="submitForm()">
                    <i class="fas fa-save me-2"></i>Yes, Update Business Type
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* Business Type specific styling */
.qna-preview-item {
    transition: all 0.3s ease;
    border: 2px solid var(--border) !important;
}

.qna-preview-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 173, 181, 0.1);
    border-color: var(--primary) !important;
}

.update-item, .protected-item {
    transition: all 0.3s ease;
    padding: 0.5rem;
    border-radius: 12px;
}

.update-item:hover, .protected-item:hover {
    background: rgba(0, 173, 181, 0.05);
    transform: translateX(5px);
}

/* Form styling */
.form-select {
    border: 2px solid var(--border);
    border-radius: 12px;
    padding: 0.75rem 1rem;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: white;
}

.form-select:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 173, 181, 0.1);
    outline: none;
}

/* Checkbox styling */
.form-check-input:checked {
    background-color: var(--primary);
    border-color: var(--primary);
}

.form-check-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 173, 181, 0.1);
}

/* Warning card styling */
.card-modern[style*="border: 2px solid var(--warning)"] {
    transition: all 0.3s ease;
}

.card-modern[style*="border: 2px solid var(--warning)"]:hover {
    box-shadow: 0 8px 25px rgba(255, 193, 7, 0.15);
    transform: translateY(-2px);
}

/* Mobile responsive */
@media (max-width: 768px) {
    .qna-preview-item .d-flex {
        flex-direction: column;
        gap: 1rem;
    }
    
    .qna-preview-item .bg-gradient-primary {
        align-self: center;
    }
    
    .update-item .d-flex,
    .protected-item .d-flex {
        align-items: center !important;
    }
    
    /* Hero section mobile */
    .bg-gradient-dark .col-lg-8,
    .bg-gradient-dark .col-lg-4 {
        text-align: center;
    }
    
    .bg-gradient-dark .col-lg-4 {
        margin-top: 1rem;
    }
    
    /* Alert responsive */
    .alert.glass-effect .row .col-lg-3,
    .alert.glass-effect .row .col-md-6 {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
}

@media (max-width: 576px) {
    .bg-gradient-dark {
        padding: 2rem 0 !important;
    }
    
    .bg-gradient-dark h1 {
        font-size: 1.5rem !important;
    }
    
    .bg-gradient-primary.rounded-circle.p-3 {
        width: 50px !important;
        height: 50px !important;
    }
    
    .update-item, .protected-item {
        margin-bottom: 1rem !important;
    }
    
    /* Modal mobile adjustments */
    .modal-dialog {
        margin: 1rem;
    }
    
    .d-flex.justify-content-between {
        flex-direction: column;
        gap: 1rem;
    }
    
    .d-flex.justify-content-between .btn {
        width: 100%;
        text-align: center;
    }
}

/* Animation for interactions */
.btn {
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.btn:active {
    transform: translateY(0);
}

/* Loading animation */
.loading {
    position: relative;
    overflow: hidden;
}

.loading::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
    animation: loading 1.5s infinite;
}

@keyframes loading {
    0% { left: -100%; }
    100% { left: 100%; }
}

/* Card animation */
.card-modern {
    animation: slideInUp 0.5s ease-out;
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
function confirmChange() {
    const currentType = "{{ assistant.business_type.name }}";
    const newTypeSelect = document.querySelector('select[name="business_type"]');
    const newType = newTypeSelect.options[newTypeSelect.selectedIndex].text;
    const regenerateQnAs = document.getElementById('regenerate_qnas').checked;
    
    // Check if business type actually changed
    if (currentType === newType) {
        showToast('Please select a different business type to make changes.', 'warning');
        return false;
    }
    
    let message = `
        <div class="text-center mb-4">
            <div class="bg-gradient-primary rounded-circle mx-auto mb-3" style="width: 80px; height: 80px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-exchange-alt text-white fs-1"></i>
            </div>
        </div>
        
        <div class="alert alert-primary border-0 glass-effect mb-4">
            <div class="text-center">
                <h6 class="mb-2 fw-semibold">Business Type Change</h6>
                <div class="d-flex justify-content-center align-items-center gap-3">
                    <span class="badge bg-secondary px-3 py-2">${currentType}</span>
                    <i class="fas fa-arrow-right text-primary"></i>
                    <span class="badge bg-primary px-3 py-2">${newType}</span>
                </div>
            </div>
        </div>
    `;
    
    if (regenerateQnAs) {
        message += `
            <div class="alert alert-danger border-0">
                <div class="d-flex align-items-start">
                    <i class="fas fa-exclamation-triangle me-3 text-danger"></i>
                    <div>
                        <h6 class="mb-2 fw-semibold text-danger">Q&A Regeneration Warning</h6>
                        <p class="mb-0">You have chosen to regenerate Q&As. This will <strong>permanently delete</strong> 
                        all your current Q&As ({{ assistant.qnas.count }} items) and replace them with new ones 
                        optimized for <strong>${newType}</strong> business.</p>
                    </div>
                </div>
            </div>
        `;
    } else {
        message += `
            <div class="alert alert-info border-0">
                <div class="d-flex align-items-start">
                    <i class="fas fa-info-circle me-3 text-info"></i>
                    <div>
                        <h6 class="mb-2 fw-semibold text-info">Q&A Preservation</h6>
                        <p class="mb-0">Your existing Q&As will be kept unchanged, but the AI assistant will respond 
                        in the context of a <strong>${newType}</strong> business.</p>
                    </div>
                </div>
            </div>
        `;
    }
    
    message += `
        <div class="text-center mt-4">
            <h6 class="fw-semibold">Are you sure you want to proceed with this change?</h6>
        </div>
    `;
    
    document.getElementById('confirmMessage').innerHTML = message;
    const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
    modal.show();
    
    return false; // Prevent form submission
}

function submitForm() {
    // Show loading state
    const submitBtn = document.querySelector('button[onclick="submitForm()"]');
    const originalHTML = submitBtn.innerHTML;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Updating...';
    submitBtn.disabled = true;
    
    // Close modal and submit form
    const modal = bootstrap.Modal.getInstance(document.getElementById('confirmModal'));
    modal.hide();
    
    showToast('Updating business type configuration...', 'info');
    
    // Submit the form
    document.getElementById('businessTypeForm').submit();
}

// Enhanced form validation and interactions
document.addEventListener('DOMContentLoaded', function() {
    // Style the select element
    const selectElement = document.querySelector('select[name="business_type"]');
    if (selectElement) {
        selectElement.classList.add('form-select');
        
        // Add change listener for dynamic feedback
        selectElement.addEventListener('change', function() {
            const currentType = "{{ assistant.business_type.name }}";
            const newType = this.options[this.selectedIndex].text;
            
            if (currentType !== newType) {
                showToast(`Selected: ${newType}`, 'success');
            }
        });
    }
    
    // Add change listener to checkbox for dynamic feedback
    const checkbox = document.getElementById('regenerate_qnas');
    checkbox.addEventListener('change', function() {
        if (this.checked) {
            showToast('Q&A regeneration enabled - existing Q&As will be replaced', 'warning');
        } else {
            showToast('Q&A regeneration disabled - existing Q&As will be preserved', 'info');
        }
    });
    
    // Add form validation
    document.getElementById('businessTypeForm').addEventListener('submit', function(e) {
        const currentType = "{{ assistant.business_type.name }}";
        const newTypeSelect = document.querySelector('select[name="business_type"]');
        const newType = newTypeSelect.options[newTypeSelect.selectedIndex].text;
        
        if (currentType === newType) {
            e.preventDefault();
            showToast('Please select a different business type before submitting.', 'error');
            return false;
        }
    });
    
    // Show welcome message
    showToast('Business Type Editor loaded successfully!', 'success');
});

// Toast notification function
function showToast(message, type = 'info') {
    // Create toast if it doesn't exist
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        toastContainer.style.zIndex = '9999';
        document.body.appendChild(toastContainer);
    }
    
    const toastId = 'toast-' + Date.now();
    const toast = document.createElement('div');
    toast.id = toastId;
    toast.className = `toast align-items-center border-0`;
    toast.setAttribute('role', 'alert');
    
    // Set toast color based on type
    let bgClass = 'bg-primary text-white';
    let icon = 'fas fa-info-circle';
    
    switch(type) {
        case 'success':
            bgClass = 'bg-success text-white';
            icon = 'fas fa-check-circle';
            break;
        case 'warning':
            bgClass = 'bg-warning text-dark';
            icon = 'fas fa-exclamation-triangle';
            break;
        case 'error':
            bgClass = 'bg-danger text-white';
            icon = 'fas fa-exclamation-circle';
            break;
    }
    
    toast.className += ` ${bgClass}`;
    
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body d-flex align-items-center">
                <i class="${icon} me-2"></i>
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    
    toastContainer.appendChild(toast);
    
    const bsToast = new bootstrap.Toast(toast, {
        autohide: true,
        delay: type === 'error' ? 5000 : 3000
    });
    
    bsToast.show();
    
    // Remove toast element after it's hidden
    toast.addEventListener('hidden.bs.toast', function() {
        toast.remove();
    });
}
</script>
{% endblock %}