{% extends 'base.html' %}

{% block title %}Test Chat - AI Agent Customer Service{% endblock %}

{% block content %}
<!-- Dashboard-style Hero Section -->
<div class="bg-gradient-dark text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-gradient-primary rounded-circle p-3 me-3" style="width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-comments fs-3"></i>
                    </div>
                    <div>
                        <h1 class="mb-1 fw-bold">Test Your AI Assistant</h1>
                        <p class="mb-0 opacity-75">Interact with your {{ assistant.business_type.name }} assistant</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 text-lg-end">
                <a href="{% url 'dashboard' %}" class="btn btn-sm btn-outline-light">
                    <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                </a>
            </div>
        </div>
        
        <!-- Assistant Info Alert -->
        <div class="alert alert-info glass-effect mt-4">
            <div class="row g-2">
                <div class="col-lg-3 col-md-6">
                    <strong>Assistant:</strong> {{ assistant.business_type.name }} Customer Service
                </div>
                <div class="col-lg-2 col-md-6">
                    <strong>Knowledge:</strong> {{ assistant.knowledge_base.count }} items
                </div>
                <div class="col-lg-2 col-md-6">
                    <strong>Q&A:</strong> {{ assistant.qnas.count }} pairs
                </div>
                <div class="col-lg-3 col-md-6">
                    <strong>API Key:</strong> <code class="text-white bg-dark px-2 py-1 rounded">{{ assistant.api_key }}</code>
                </div>
                <div class="col-lg-2 col-md-6">
                    <strong>Status:</strong> <span class="badge bg-success">Online</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-n3 position-relative" style="z-index: 10;">
    
    <!-- Main Chat Interface -->
    <div class="row justify-content-center">
        <div class="col-12 col-xl-10">
            <div class="card-modern">
                <div class="card-header-modern d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="bg-gradient-primary rounded-circle p-2 me-3" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-robot text-white"></i>
                        </div>
                        <div>
                            <span class="fw-bold">{{ assistant.business_type.name }} Assistant</span>
                            <div class="d-flex align-items-center">
                                <div class="bg-success rounded-circle me-1" style="width: 8px; height: 8px;"></div>
                                <small class="opacity-75">Online and ready to help</small>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-outline-light" onclick="clearConversation()">
                        <i class="fas fa-trash me-1"></i>Clear Chat
                    </button>
                </div>
                <div class="card-body-modern p-0">
                    <!-- Chat Messages -->
                    <div id="chatMessages" class="chat-container p-3" style="height: 500px; overflow-y: auto; background: #f8f9fa;">
                        <div class="message assistant mb-3">
                            <div class="d-flex align-items-start">
                                <div class="bg-gradient-primary rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-robot text-white"></i>
                                </div>
                                <div class="message-content bg-white p-3 rounded shadow-sm">
                                    <div class="d-flex align-items-center mb-2">
                                        <strong class="text-primary-modern">{{ assistant.business_type.name }} Assistant</strong>
                                        <span class="badge bg-primary ms-2">AI</span>
                                    </div>
                                    Hello! I'm your AI assistant. I can help answer questions about your business. Try asking me something!
                                    <div class="small text-muted mt-2">
                                        <i class="fas fa-clock me-1"></i>Just now
                                        <i class="fas fa-robot ms-2 me-1"></i>AI Assistant
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chat Input Section -->
                    <div class="chat-input-section p-2 bg-white border-top">
                        <!-- Language Selection -->
                        <div class="language-selector mb-2">
                            <label class="form-label small text-muted mb-1">
                                <i class="fas fa-language me-1"></i>Language / Bahasa:
                            </label>
                            <select class="form-select form-select-sm" id="languageSelect" onchange="updateLanguagePlaceholder()" style="max-width: 250px;">
                                <option value="auto">Auto-Detect / Kesan Automatik</option>
                                <option value="en">English Only / Bahasa Inggeris</option>
                                <option value="ms">Bahasa Malaysia Sahaja</option>
                            </select>
                        </div>
                        
                        <!-- Message Input - WhatsApp Style -->
                        <div class="input-group mb-2" style="width: 100%; display: flex; gap: 8px;">
                            <input 
                                type="text" 
                                class="form-control-modern flex-grow-1" 
                                placeholder="Type your message here..." 
                                id="messageInput"
                                onkeypress="handleKeyPress(event)"
                                style="border: 2px solid var(--border); border-radius: 20px; padding: 0.75rem 1rem; font-size: 1rem; min-width: 0;"
                            >
                            <button class="btn-primary-modern btn-send-whatsapp" onclick="sendMessage()" id="sendBtn" style="border-radius: 50%; width: 45px; height: 45px; padding: 0; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <i class="fas fa-paper-plane" style="font-size: 0.9rem;"></i>
                            </button>
                        </div>
                        
                        <!-- Quick Test Buttons -->
                        <div class="quick-actions">
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-bolt me-1 text-primary-modern"></i>Quick tests:
                                </small>
                            </div>
                            <div id="quickButtons" class="d-flex flex-wrap gap-1">
                                <!-- English quick buttons (default) -->
                                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('What are your business hours?')">
                                    <i class="fas fa-clock me-1"></i>Business Hours
                                </button>
                                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('What services do you offer?')">
                                    <i class="fas fa-cogs me-1"></i>Services
                                </button>
                                <button class="btn btn-sm btn-outline-modern" onclick="sendQuickMessage('How can I contact you?')">
                                    <i class="fas fa-phone me-1"></i>Contact Info
                                </button>
                                <button class="btn btn-sm btn-outline-modern" onclick="sendQuickMessage('Do you offer delivery?')">
                                    <i class="fas fa-truck me-1"></i>Delivery
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast Notifications -->
<div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 9999;">
    <div id="notification-toast" class="toast" role="alert">
        <div class="toast-header">
            <i class="fas fa-comments me-2 text-primary-modern"></i>
            <strong class="me-auto">Chat Assistant</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toast-message">
            <!-- Dynamic message content -->
        </div>
    </div>
</div>

{% endblock %}

{% block extra_css %}
<style>
/* Chat-specific styling consistent with dashboard */
.chat-container::-webkit-scrollbar {
    width: 6px;
}

.chat-container::-webkit-scrollbar-track {
    background: var(--border);
    border-radius: 3px;
}

.chat-container::-webkit-scrollbar-thumb {
    background: var(--primary);
    border-radius: 3px;
}

.chat-container::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 173, 181, 0.8);
}

/* Message Styling */
.message {
    animation: messageSlideIn 0.5s ease-out;
}

@keyframes messageSlideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.message-content {
    max-width: 85%;
    word-wrap: break-word;
    border-radius: 16px;
    position: relative;
    transition: all 0.3s ease;
}

.message-content:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

/* Input styling */
.form-control-modern:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(0, 173, 181, 0.1);
    outline: none;
}

/* WhatsApp-style input group */
.input-group {
    width: 100% !important;
    display: flex !important;
    align-items: center !important;
    gap: 8px !important;
}

.input-group .form-control-modern {
    flex: 1 !important;
    min-width: 0 !important;
    border-radius: 20px !important;
    border: 2px solid var(--border) !important;
}

.input-group .btn-send-whatsapp {
    flex-shrink: 0 !important;
    width: 45px !important;
    height: 45px !important;
    border-radius: 50% !important;
    background: var(--gradient-primary) !important;
    border: none !important;
    color: white !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    transition: all 0.3s ease !important;
}

.input-group .btn-send-whatsapp:hover {
    transform: scale(1.05) !important;
    box-shadow: 0 4px 15px rgba(0, 173, 181, 0.3) !important;
}

.input-group .btn-send-whatsapp:active {
    transform: scale(0.95) !important;
}

/* Extra small button size */
.btn-xs {
    padding: 0.25rem 0.5rem !important;
    font-size: 0.75rem !important;
    border-radius: 0.375rem !important;
}

/* Quick buttons */
.quick-actions .btn-outline-modern:hover {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
    transform: translateY(-2px);
}

/* Typing Animation */
.typing-animation {
    display: flex;
    gap: 4px;
    align-items: center;
    padding: 0.5rem 0;
}

.typing-animation span {
    width: 8px;
    height: 8px;
    background: var(--primary);
    border-radius: 50%;
    animation: typing 1.4s infinite;
}

.typing-animation span:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-animation span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing {
    0%, 60%, 100% {
        transform: translateY(0);
        opacity: 0.5;
    }
    30% {
        transform: translateY(-10px);
        opacity: 1;
    }
}

/* Mobile Responsive */
@media (max-width: 992px) {
    .message-content {
        max-width: 90%;
    }
}

@media (max-width: 768px) {
    .chat-container {
        height: 450px !important;
    }
    
    .message-content {
        max-width: 92%;
    }
    
    .quick-actions #quickButtons {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .quick-actions .btn {
        width: 100%;
        justify-content: flex-start;
    }
    
    /* Hero section mobile adjustments */
    .bg-gradient-dark .col-lg-8,
    .bg-gradient-dark .col-lg-4 {
        text-align: center;
    }
    
    .bg-gradient-dark .col-lg-4 {
        margin-top: 1rem;
    }
    
    /* Alert responsive */
    .alert.glass-effect .row .col-lg-3,
    .alert.glass-effect .row .col-lg-2,
    .alert.glass-effect .row .col-md-6 {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
}

@media (max-width: 576px) {
    .chat-container {
        height: 400px !important;
        padding: 1rem !important;
    }
    
    .message-content {
        max-width: 95%;
        padding: 0.75rem 1rem !important;
    }
    
    .chat-input-section {
        padding: 1rem !important;
    }
    
    /* Smaller avatars on mobile */
    .bg-gradient-primary.rounded-circle {
        width: 30px !important;
        height: 30px !important;
    }
    
    .bg-gradient-primary.rounded-circle i {
        font-size: 0.8rem !important;
    }
    
    /* Mobile WhatsApp-style input */
    .input-group {
        gap: 6px !important;
    }
    
    .form-control-modern {
        font-size: 16px !important; /* Prevent zoom on iOS */
        padding: 0.75rem 1rem !important;
        border-radius: 18px !important;
    }
    
    .btn-send-whatsapp {
        width: 40px !important;
        height: 40px !important;
    }
    
    .btn-send-whatsapp i {
        font-size: 0.8rem !important;
    }
    
    /* Hero section mobile */
    .bg-gradient-dark {
        padding: 2rem 0 !important;
    }
    
    .bg-gradient-dark h1 {
        font-size: 1.5rem !important;
    }
    
    .bg-gradient-primary.rounded-circle.p-3 {
        width: 50px !important;
        height: 50px !important;
    }
    
    /* Alert mobile responsive */
    .alert.glass-effect {
        font-size: 0.85rem;
    }
    
    .alert.glass-effect code {
        font-size: 0.7rem !important;
        padding: 2px 4px !important;
        word-break: break-all;
    }
    
    /* Quick buttons mobile */
    .quick-actions #quickButtons {
        gap: 0.5rem !important;
    }
    
    .quick-actions .btn-xs {
        padding: 0.375rem 0.75rem !important;
        font-size: 0.7rem !important;
    }
}

/* Ultra small screens */
@media (max-width: 400px) {
    .message-content {
        max-width: 98%;
        padding: 0.5rem 0.75rem !important;
        font-size: 0.9rem;
    }
    
    .chat-container {
        height: 350px !important;
        padding: 0.5rem !important;
    }
    
    .chat-input-section {
        padding: 0.75rem !important;
    }
    
    /* Ultra small WhatsApp-style input */
    .input-group {
        gap: 4px !important;
    }
    
    .form-control-modern {
        padding: 0.6rem 0.8rem !important;
        border-radius: 16px !important;
        font-size: 14px !important;
    }
    
    .btn-send-whatsapp {
        width: 36px !important;
        height: 36px !important;
    }
    
    .btn-send-whatsapp i {
        font-size: 0.7rem !important;
    }
    
    /* Ultra small quick buttons */
    .quick-actions #quickButtons {
        flex-direction: column !important;
        gap: 0.25rem !important;
    }
    
    .quick-actions .btn-xs {
        width: 100% !important;
        justify-content: flex-start !important;
        padding: 0.25rem 0.5rem !important;
        font-size: 0.65rem !important;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
let sessionId = null;

function handleKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
    }
}

function sendQuickMessage(message) {
    document.getElementById('messageInput').value = message;
    sendMessage();
}

function updateLanguagePlaceholder() {
    const languageSelect = document.getElementById('languageSelect');
    const messageInput = document.getElementById('messageInput');
    const quickButtons = document.getElementById('quickButtons');
    const selectedLang = languageSelect.value;
    
    switch(selectedLang) {
        case 'ms':
            messageInput.placeholder = 'Taip mesej anda di sini...';
            quickButtons.innerHTML = `
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('Apa waktu operasi perniagaan?')">
                    <i class="fas fa-clock me-1"></i>Waktu Operasi
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('Apa perkhidmatan yang anda tawarkan?')">
                    <i class="fas fa-cogs me-1"></i>Perkhidmatan
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('Bagaimana saya boleh menghubungi anda?')">
                    <i class="fas fa-phone me-1"></i>Maklumat Hubungan
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('Adakah anda menawarkan penghantaran?')">
                    <i class="fas fa-truck me-1"></i>Penghantaran
                </button>
            `;
            break;
        case 'en':
            messageInput.placeholder = 'Type your message here...';
            quickButtons.innerHTML = `
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('What are your business hours?')">
                    <i class="fas fa-clock me-1"></i>Business Hours
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('What services do you offer?')">
                    <i class="fas fa-cogs me-1"></i>Services
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('How can I contact you?')">
                    <i class="fas fa-phone me-1"></i>Contact Info
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('Do you offer delivery?')">
                    <i class="fas fa-truck me-1"></i>Delivery
                </button>
            `;
            break;
        case 'auto':
        default:
            messageInput.placeholder = 'Type your message here / Taip mesej anda di sini...';
            quickButtons.innerHTML = `
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('What are your business hours?')">
                    <i class="fas fa-clock me-1"></i>Business Hours
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('What services do you offer?')">
                    <i class="fas fa-cogs me-1"></i>Services
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('Apa waktu operasi perniagaan?')">
                    <i class="fas fa-clock me-1"></i>Waktu Operasi
                </button>
                <button class="btn btn-xs btn-outline-modern" onclick="sendQuickMessage('Bagaimana saya boleh menghubungi anda?')">
                    <i class="fas fa-phone me-1"></i>Maklumat Hubungan
                </button>
            `;
            break;
    }
}

function clearConversation() {
    const messagesContainer = document.getElementById('chatMessages');
    messagesContainer.innerHTML = `
        <div class="message assistant mb-3">
            <div class="d-flex align-items-start">
                <div class="bg-gradient-primary rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-robot text-white"></i>
                </div>
                <div class="message-content bg-white p-3 rounded shadow-sm">
                    <div class="d-flex align-items-center mb-2">
                        <strong class="text-primary-modern">{{ assistant.business_type.name }} Assistant</strong>
                        <span class="badge bg-primary ms-2">AI</span>
                    </div>
                    Hello! I'm your AI assistant. I can help answer questions about your business. Try asking me something!
                    <div class="small text-muted mt-2">
                        <i class="fas fa-clock me-1"></i>Just now
                        <i class="fas fa-robot ms-2 me-1"></i>AI Assistant
                    </div>
                </div>
            </div>
        </div>
    `;
    sessionId = null;
    showToast('Conversation cleared successfully!', 'success');
}

async function sendMessage() {
    const input = document.getElementById('messageInput');
    const languageSelect = document.getElementById('languageSelect');
    const sendBtn = document.getElementById('sendBtn');
    const message = input.value.trim();
    const selectedLanguage = languageSelect.value;
    
    if (!message) return;
    
    // Disable input while processing
    input.disabled = true;
    sendBtn.disabled = true;
    sendBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    
    // Add user message to chat
    addMessage(message, 'user');
    input.value = '';
    
    // Show typing indicator
    showTyping();
    
    try {
        const response = await fetch('{% url "test_chat" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify({
                message: message,
                session_id: sessionId,
                language: selectedLanguage
            })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            sessionId = data.session_id;
            addMessage(data.response, 'assistant');
            showToast('Message sent successfully!', 'success');
        } else {
            addMessage('Sorry, I encountered an error. Please try again.', 'assistant');
            showToast('Sorry, I encountered an error. Please try again.', 'error');
        }
    } catch (error) {
        console.error('Error:', error);
        addMessage('Sorry, I encountered an error. Please try again.', 'assistant');
        showToast('Connection error. Please try again.', 'error');
    }
    
    hideTyping();
    
    // Re-enable input
    input.disabled = false;
    sendBtn.disabled = false;
    sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
    input.focus();
}

function addMessage(content, type) {
    const messagesContainer = document.getElementById('chatMessages');
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type} mb-3`;
    
    const currentTime = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    
    if (type === 'user') {
        messageDiv.innerHTML = `
            <div class="d-flex align-items-start justify-content-end">
                <div class="message-content p-3 rounded shadow-sm me-3" style="background: var(--gradient-primary); color: white; max-width: 85%;">
                    <div class="d-flex align-items-center justify-content-end mb-2">
                        <small class="me-2" style="color: rgba(255,255,255,0.8);">${currentTime}</small>
                        <strong>You</strong>
                    </div>
                    <div>${content}</div>
                </div>
                <div class="bg-light rounded-circle p-2 d-flex align-items-center justify-content-center border border-primary" style="width: 35px; height: 35px;">
                    <i class="fas fa-user text-primary"></i>
                </div>
            </div>
        `;
    } else {
        messageDiv.innerHTML = `
            <div class="d-flex align-items-start">
                <div class="bg-gradient-primary rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                    <i class="fas fa-robot text-white"></i>
                </div>
                <div class="message-content bg-white p-3 rounded shadow-sm" style="max-width: 85%;">
                    <div class="d-flex align-items-center mb-2">
                        <strong class="text-primary-modern">{{ assistant.business_type.name }} Assistant</strong>
                        <span class="badge bg-primary ms-2">AI</span>
                    </div>
                    <div>${content}</div>
                    <div class="small text-muted mt-2">
                        <i class="fas fa-clock me-1"></i>${currentTime}
                        <i class="fas fa-robot ms-2 me-1"></i>AI Assistant
                    </div>
                </div>
            </div>
        `;
    }
    
    messagesContainer.appendChild(messageDiv);
    
    // Scroll to bottom smoothly
    messagesContainer.scrollTo({
        top: messagesContainer.scrollHeight,
        behavior: 'smooth'
    });
}

function showTyping() {
    const messagesContainer = document.getElementById('chatMessages');
    const typingDiv = document.createElement('div');
    typingDiv.className = 'message assistant mb-3 typing-indicator';
    typingDiv.id = 'typing-indicator';
    
    typingDiv.innerHTML = `
        <div class="d-flex align-items-start">
            <div class="bg-gradient-primary rounded-circle p-2 me-3" style="width: 35px; height: 35px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-robot text-white"></i>
            </div>
            <div class="message-content bg-white p-3 rounded shadow-sm">
                <div class="d-flex align-items-center mb-2">
                    <strong class="text-primary-modern">{{ assistant.business_type.name }} Assistant</strong>
                    <small class="text-muted ms-2">typing...</small>
                </div>
                <div class="typing-animation">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </div>
    `;
    
    messagesContainer.appendChild(typingDiv);
    messagesContainer.scrollTo({
        top: messagesContainer.scrollHeight,
        behavior: 'smooth'
    });
}

function hideTyping() {
    const typingIndicator = document.getElementById('typing-indicator');
    if (typingIndicator) {
        typingIndicator.remove();
    }
}

function showToast(message, type = 'info') {
    const toast = document.getElementById('notification-toast');
    const toastMessage = document.getElementById('toast-message');
    
    toastMessage.textContent = message;
    toast.className = `toast ${type === 'error' ? 'bg-danger text-white' : 'bg-success text-white'}`;
    
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('messageInput').focus();
    updateLanguagePlaceholder();
});
</script>
{% endblock %}